<!doctype html>
<!--
    "Squares" by Clif Bratcher 2013
-->
<html>
  <head>
    <title>Squares</title>
    <script src="js/two.min.js"></script>
    <script src="js/random.js"></script>
    <style>
    body {
      background-color: #333;
    }
    </style>
  </head>
  <body>
    <script>
      var two = new Two({
        fullscreen: true,
        autostart: true
      }).appendTo(document.body);

      var midx = two.width / 2;
      var midy = two.height / 2;

      var randX = function() {
        do {
          var x = two.width * (Random.int(5) + 1)/6;
          x = (x == midx) ? 0 : x;
        } while (x == 0);
        return x;
      };

      var randY = function() {
        do {
          var y = two.height * (Random.int(5) + 1)/6;
          y = (y == midy) ? 0 : y;
        } while (y == 0);
        return y;
      };


      var newSquare = function() {
        var x = randX();
        var y = randY();
        var size = 10 + Math.random() * 60;
        console.log(x,y);
        var square = two.makeRectangle(x, y, size, size);
        square.opacity = .5;
        square.clockwise = Random.bool();
        square.growthRate = Random.float(.1);
        return square;
      };

      var sq = [];

      for (var m=0; m < 5 + Random.int(20); m++)
        sq[m] = newSquare();

      sq[0].translation.set(midx, midy);
      sq[0].fill = '#900';

      var step = function(obj) {
        obj.linewidth = Random.float(.5);
        var rotationAmt = 0.1 * (Random.float(.1) - .3);

        if (obj.clockwise)
          obj.rotation += rotationAmt;
        else
          obj.rotation -= rotationAmt;

        if (obj.grow == true)
          obj.scale += obj.growthRate;
        else
          obj.scale -= obj.growthRate;

        if (obj.scale >= 7)
          obj.grow = false;
        else if (obj.scale <= .15) {
          if (obj.id !== 1)
            obj.translation.set(randX(), randY());
          obj.grow = true;
        }
      };

      two.bind('update', function() {
        for (var i in sq)
          step (sq[i]);
      });

    </script>
  </body>
</html>
